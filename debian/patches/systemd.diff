# DP: systemd service files for Debian

--- a/instfiles/xrdp-sesman.service
+++ b/instfiles/xrdp-sesman.service
@@ -1,13 +1,12 @@
 [Unit]
-Description=xrdp session manager
-After=syslog.target network.target
-StopWhenUnneeded=true
-BindTo=xrdp.service
+Description=xrdp (X Remote Desktop Protocol) session manager
+Requires=xrdp.service
+After=network.target xrdp.service
 
 [Service]
 Type=forking
-PIDFile=/var/run/xrdp-sesman.pid
-EnvironmentFile=/etc/sysconfig/xrdp
+EnvironmentFile=/etc/default/xrdp
+PIDFile=/run/xrdp/xrdp-sesman.pid
 ExecStart=/usr/sbin/xrdp-sesman $SESMAN_OPTIONS
 ExecStop=/usr/sbin/xrdp-sesman $SESMAN_OPTIONS --kill
 
--- a/instfiles/xrdp.service
+++ b/instfiles/xrdp.service
@@ -1,14 +1,18 @@
 [Unit]
-Description=xrdp daemon
-Requires=xrdp-sesman.service
-After=syslog.target network.target xrdp-sesman.service
+Description=xrdp (X Remote Desktop Protocol) protocol server
+After=network.target
 
 [Service]
 Type=forking
-PIDFile=/var/run/xrdp.pid
-EnvironmentFile=/etc/sysconfig/xrdp
-ExecStart=/usr/sbin/xrdp $XRDP_OPTIONS --nodaemon
+EnvironmentFile=/etc/default/xrdp
+PIDFile=/run/xrdp/xrdp.pid
+User=xrdp
+Group=xrdp
+PermissionsStartOnly=true
+ExecStartPre=/bin/sh /usr/share/xrdp/socksetup
+ExecStart=/usr/sbin/xrdp $XRDP_OPTIONS
 ExecStop=/usr/sbin/xrdp $XRDP_OPTIONS --kill
+ExecStopPost=/bin/rm -rf /var/run/xrdp/sockdir
 
 [Install]
 WantedBy=multi-user.target
